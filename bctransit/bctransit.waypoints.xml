<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <sampleQuery></sampleQuery>
    </meta>
    <bindings>
        <select produces="XML">
            <urls>
                <url>http://www.bctransit.com/regions/{region}/schedules/schedule.cfm?route={route}:{direction}&amp;day={day}</url>
            </urls>
            <inputs>
                <key id="region" paramType="path" required="true" type="xs:string"/>
                <key id="route" paramType="path" required="true" type="xs:string"/>
                <key id="direction" paramType="path" default="0" type="xs:string"/>
                <key id="day" paramType="path" default="1" type="xs:string"/>
            </inputs>
            <execute><![CDATA[
                var statement = [
                        "select content from html",
                        "where url=@url",
                        "and xpath=@xpath",
                        '| unique(field="content", hideRepeatCount="true")'
                    ].join( " " ),
                    
                    query = y.query( statement, {
                        url: request.url,
                        xpath: '//td[@class="css-sched-waypoints" and @width="100"]/p'
                    }),
                    
                    xml = <waypoints/>;
                    
                for each ( var p in query.results.p ) {
                    xml.waypoints += <waypoint>
                        <title>{p.text()}</title>
                    </waypoint>;
                }
                    
                response.object = xml;
            ]]></execute>
        </select>
    </bindings>
</table>